<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>BGA-Trainer (Basis / Advanced)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind CDN (für dieses Trainings-Tool okay) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: #0f172a;
      color: #111827;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }
    .header {
      background: linear-gradient(to right, #111827, #1e293b);
      color: #e5e7eb;
      padding: 16px 20px;
      border-radius: 16px;
      margin-bottom: 20px;
      box-shadow: 0 10px 30px rgba(15,23,42,0.6);
    }
    .card {
      background-color: #ffffff;
      border-radius: 14px;
      padding: 18px 16px;
      margin-bottom: 16px;
      box-shadow: 0 10px 25px rgba(15,23,42,0.14);
      border: 1px solid #e5e7eb;
    }
    .bga-table {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(110px,1fr));
      gap: 10px;
    }
    .bga-item {
      position: relative;
      background-color: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
    }
    .bga-item label {
      display: block;
      font-size: 0.75rem;
      color: #6b7280;
      font-weight: 500;
    }
    .bga-item input {
      font-size: 1.3rem;
      font-weight: 700;
      color: #111827;
      width: 100%;
      border: none;
      background: transparent;
      text-align: center;
      padding-top: 2px;
      outline: none;
    }
    .tooltip {
      position: absolute;
      top: 4px;
      right: 4px;
      cursor: help;
      color: #9ca3af;
      font-size: 0.65rem;
    }
    .tooltip-text {
      visibility: hidden;
      position: absolute;
      z-index: 10;
      width: 210px;
      bottom: 120%;
      left: 50%;
      transform: translateX(-50%);
      background-color: #111827;
      color: #fff;
      padding: 6px;
      border-radius: 6px;
      font-size: 0.7rem;
      text-align: left;
      opacity: 0;
      transition: opacity 0.2s;
    }
    .tooltip:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.6rem 0.9rem;
      border-radius: 0.6rem;
      font-weight: 600;
      font-size: 0.85rem;
      border: none;
      cursor: pointer;
      transition: transform 0.08s, box-shadow 0.08s, background-color 0.15s;
      white-space: nowrap;
    }
    .btn-primary {
      background-color: #111827;
      color: #f9fafb;
    }
    .btn-primary:hover {
      background-color: #0f172a;
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(15,23,42,0.3);
    }
    .btn-secondary {
      background-color: #e5e7eb;
      color: #111827;
    }
    .btn-secondary:hover {
      background-color: #d1d5db;
    }
    .btn-gemini {
      background-color: #f97316;
      color: #111827;
    }
    .btn-gemini:hover {
      background-color: #ea580c;
      color: #111827;
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(234,88,12,0.35);
    }
    .mode-switch {
      display: inline-flex;
      background-color: #111827;
      border-radius: 9999px;
      padding: 4px;
      gap: 4px;
    }
    .mode-switch input {
      display: none;
    }
    .mode-switch label {
      padding: 4px 10px;
      font-size: 0.75rem;
      border-radius: 9999px;
      cursor: pointer;
      color: #9ca3af;
      font-weight: 500;
    }
    .mode-switch input:checked + label {
      background-color: #f97316;
      color: #111827;
    }
    .result-box {
      background-color: #f9fafb;
      border-radius: 10px;
      padding: 10px;
      font-size: 0.8rem;
      margin-top: 10px;
      border: 1px solid #e5e7eb;
    }
    textarea.prompt-box {
      width: 100%;
      margin-top: 8px;
      padding: 6px 8px;
      font-size: 0.7rem;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      resize: vertical;
    }
  </style>
</head>
<body class="p-4 md:p-8">
<div class="max-w-3xl mx-auto">

  <!-- Header -->
  <header class="header">
    <div class="flex justify-between items-center">
      <h1 class="text-xl md:text-2xl font-bold">BGA-Trainer (Basis / Advanced)</h1>
      <div id="mode-chip" class="bg-white/10 text-xs font-semibold px-3 py-1 rounded-full">
        BASIS MODUS
      </div>
    </div>
    <p class="text-xs text-gray-400 mt-1">
      Übungstool für Säure-Basen-Analyse. Kein Medizinprodukt. Keine klinische Anwendung.
    </p>
  </header>

  <!-- Modus-Umschalter -->
  <div class="card flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
    <div>
      <h2 class="text-sm font-semibold text-gray-800 m-0">Lern-Modus</h2>
      <p class="text-xs text-gray-600 m-0">Wähle den Schwierigkeitsgrad der Fälle.</p>
    </div>
    <div class="mode-switch">
      <input type="radio" id="mode-basic" name="mode" value="basic" checked>
      <label for="mode-basic">Basis</label>
      <input type="radio" id="mode-advanced" name="mode" value="advanced">
      <label for="mode-advanced">Advanced</label>
    </div>
  </div>

  <!-- Fallanzeige -->
  <div class="card">
    <div class="flex justify-between items-center mb-2">
      <h2 class="text-sm font-semibold text-gray-800 m-0">
        Fall #<span id="case-id">1</span>
        <span id="case-tags" class="text-[0.65rem] font-normal text-gray-500 ml-1"></span>
      </h2>
      <p id="case-label" class="text-[0.65rem] text-gray-500 m-0"></p>
    </div>

    <!-- Grundwerte -->
    <h3 class="text-xs font-semibold text-gray-700 mb-2">Grundwerte</h3>
    <div class="bga-table mb-3">
      <div class="bga-item">
        <label for="ph">pH</label>
        <input id="ph" type="number" step="0.01">
        <div class="tooltip">?
          <div class="tooltip-text">pH &lt;7.35: Azidose. &gt;7.45: Alkalose.</div>
        </div>
      </div>
      <div class="bga-item">
        <label for="pco2">pCO₂ (mmHg)</label>
        <input id="pco2" type="number" step="0.1">
        <div class="tooltip">?
          <div class="tooltip-text">Respiratorische Komponente. Norm: 35-45 mmHg.</div>
        </div>
      </div>
      <div class="bga-item">
        <label for="hco3">HCO₃⁻ (mmol/L)</label>
        <input id="hco3" type="number" step="0.1">
        <div class="tooltip">?
          <div class="tooltip-text">Metabolische Komponente. Norm: 22-26 mmol/L.</div>
        </div>
      </div>
    </div>

    <!-- Advanced-Werte -->
    <div id="advanced-block" class="hidden">
      <h3 class="text-xs font-semibold text-gray-700 mb-2">Erweiterte Werte</h3>
      <div class="bga-table mb-2">
        <div class="bga-item">
          <label for="be">Base Excess (mmol/L)</label>
          <input id="be" type="number" step="0.1">
        </div>
        <div class="bga-item">
          <label for="lactate">Laktat (mmol/L)</label>
          <input id="lactate" type="number" step="0.1">
        </div>
        <div class="bga-item">
          <label for="na">Na⁺ (mmol/L)</label>
          <input id="na" type="number" step="0.1">
        </div>
        <div class="bga-item">
          <label for="glucose">Glukose (mmol/L)</label>
          <input id="glucose" type="number" step="0.1">
        </div>
      </div>
    </div>

    <!-- Ergebnis -->
    <div id="result-box" class="result-box text-gray-700 text-xs mt-2">
      <strong>Analyse:</strong> Bitte Werte prüfen und auf „Auswerten“ klicken.
    </div>

    <!-- KI-Prompt-Tools (kostenfrei, manuell mit ChatGPT nutzbar) -->
    <div class="mt-3">
      <button id="ki-explain-btn" class="btn btn-gemini w-full mb-1">
        ✨ Klinische Bedeutung: Prompt erzeugen
      </button>
      <textarea id="ki-explain-output" class="prompt-box hidden" rows="5" readonly></textarea>

      <button id="ki-generate-btn" class="btn btn-gemini w-full mt-2 mb-1">
        ✨ Neuen Fall: Prompt für ChatGPT erzeugen
      </button>
      <textarea id="ki-generate-output" class="prompt-box hidden" rows="5" readonly></textarea>
    </div>

    <!-- Navigationsbuttons -->
    <div class="flex flex-wrap gap-2 mt-3">
      <button id="evalbutton" class="btn btn-primary flex-1">Auswerten</button>
      <button id="resetbutton" class="btn btn-secondary">Zurücksetzen</button>
      <button id="nextcasebutton" class="btn btn-secondary">Nächster Fall</button>
    </div>
  </div>

  <!-- Disclaimer -->
  <footer class="max-w-3xl mx-auto text-center text-[0.6rem] text-gray-400 mt-4 mb-2">
    Dieses Tool dient ausschließlich zu Übungs- und Schulungszwecken (Säure-Basen-Training).
    Keine klinische Entscheidungsgrundlage. Keine Haftung für Inhalte.
  </footer>
</div>

<script>
  // ===== Datengrundlage: Beispiel-Fälle =====
  const cases = [
    {
      id: 1,
      mode: "basic",
      tags: "Akute respiratorische Azidose (COPD-Exazerbation)",
      ph: 7.25, pco2: 60, hco3: 26,
      be: null, lactate: null, na: null, glucose: null
    },
    {
      id: 2,
      mode: "basic",
      tags: "Metabolische Azidose (z.B. Ketoazidose)",
      ph: 7.15, pco2: 25, hco3: 9,
      be: null, lactate: null, na: null, glucose: null
    },
    {
      id: 3,
      mode: "advanced",
      tags: "Laktatazidose, Mischbild",
      ph: 7.10, pco2: 30, hco3: 9,
      be: -12, lactate: 6.0, na: 150, glucose: 12
    },
    {
      id: 4,
      mode: "advanced",
      tags: "Chron. respiratorische Azidose mit kompensierter Metabolik",
      ph: 7.37, pco2: 65, hco3: 36,
      be: +8, lactate: 1.5, na: 140, glucose: 6
    }
  ];

  let currentMode = "basic";
  let currentCaseIndex = 0;

  // ===== UI Hilfen =====
  function updateModeUI() {
    const chip = document.getElementById("mode-chip");
    const advBlock = document.getElementById("advanced-block");
    if (currentMode === "basic") {
      chip.textContent = "BASIS MODUS";
      advBlock.classList.add("hidden");
    } else {
      chip.textContent = "ADVANCED MODUS";
      advBlock.classList.remove("hidden");
    }
  }

  function loadCase(index) {
    const c = cases[index];
    if (!c) return;
    currentCaseIndex = index;
    currentMode = c.mode;
    // Modus-Radio setzen
    document.getElementById("mode-basic").checked = c.mode === "basic";
    document.getElementById("mode-advanced").checked = c.mode === "advanced";
    updateModeUI();

    document.getElementById("case-id").textContent = c.id;
    document.getElementById("case-tags").textContent = c.tags ? `(${c.tags})` : "";
    document.getElementById("case-label").textContent =
      c.mode === "basic" ? "Fokus: pH, pCO₂, HCO₃⁻" : "Fokus: erweitert inkl. BE, Laktat, Na⁺, Glukose";

    // Werte einsetzen
    document.getElementById("ph").value = c.ph ?? "";
    document.getElementById("pco2").value = c.pco2 ?? "";
    document.getElementById("hco3").value = c.hco3 ?? "";
    document.getElementById("be").value = c.be ?? "";
    document.getElementById("lactate").value = c.lactate ?? "";
    document.getElementById("na").value = c.na ?? "";
    document.getElementById("glucose").value = c.glucose ?? "";

    document.getElementById("result-box").innerHTML =
      "<strong>Analyse:</strong> Interpretieren und mit „Auswerten“ prüfen.";
    document.getElementById("ki-explain-output").classList.add("hidden");
    document.getElementById("ki-generate-output").classList.add("hidden");
  }

  function getValues() {
    const v = (id) => {
      const el = document.getElementById(id);
      const val = el.value;
      return val === "" ? null : Number(val);
    };
    return {
      ph: v("ph"),
      pco2: v("pco2"),
      hco3: v("hco3"),
      be: v("be"),
      lactate: v("lactate"),
      na: v("na"),
      glucose: v("glucose")
    };
  }

  // ===== Lokale BGA-Analyse (vereinfachte Logik) =====
  function evaluateCase() {
    const { ph, pco2, hco3 } = getValues();
    const box = document.getElementById("result-box");

    if (ph == null || pco2 == null || hco3 == null) {
      box.innerHTML = "<strong>Analyse:</strong> Bitte mindestens pH, pCO₂ und HCO₃⁻ ausfüllen.";
      return;
    }

    let interpretation = [];

    if (ph < 7.35) {
      if (pco2 > 45 && hco3 >= 22) {
        interpretation.push("Primär respiratorische Azidose (CO₂-Retention).");
      } else if (hco3 < 22 && pco2 <= 45) {
        interpretation.push("Primär metabolische Azidose.");
      } else {
        interpretation.push("Mischbild / unklare Azidose. Kompensation prüfen.");
      }
    } else if (ph > 7.45) {
      if (pco2 < 35 && hco3 <= 26) {
        interpretation.push("Primär respiratorische Alkalose.");
      } else if (hco3 > 26 && pco2 >= 35) {
        interpretation.push("Primär metabolische Alkalose.");
      } else {
        interpretation.push("Mischbild / unklare Alkalose. Kompensation prüfen.");
      }
    } else {
      interpretation.push("pH im Normbereich: kompensierter Zustand oder Normalbefund.");
    }

    box.innerHTML =
      "<strong>Analyse (vereinfachtes Training):</strong><br>" +
      interpretation.map(line => "- " + line).join("<br>");
  }

  function nextCase() {
    const nextIndex = (currentCaseIndex + 1) % cases.length;
    loadCase(nextIndex);
  }

  function resetCase() {
    loadCase(currentCaseIndex);
  }

  // ===== KI-PROMPT (manuell mit ChatGPT nutzen) =====
  function buildExplainPrompt() {
    const { ph, pco2, hco3, be, lactate, na, glucose } = getValues();
    const textarea = document.getElementById("ki-explain-output");

    const parts = [];
    if (ph != null) parts.push(`pH: ${ph}`);
    if (pco2 != null) parts.push(`pCO₂: ${pco2} mmHg`);
    if (hco3 != null) parts.push(`HCO₃⁻: ${hco3} mmol/L`);
    if (be != null) parts.push(`Base Excess: ${be} mmol/L`);
    if (lactate != null) parts.push(`Laktat: ${lactate} mmol/L`);
    if (na != null) parts.push(`Na⁺: ${na} mmol/L`);
    if (glucose != null) parts.push(`Glukose: ${glucose} mmol/L`);

    const valuesLine = parts.join(", ");

    const prompt =
`Du bist Tutor für Intensivpflege / Beatmung.
Analysiere folgenden BGA-Fall nach einem strukturierten 4-Schritte-Schema:
1) Liegt eine Azidose oder Alkalose vor? (pH)
2) Primäre Störung: respiratorisch vs. metabolisch?
3) Korrekte Kompensation? (vereinfachte Regeln)
4) Plausible klinische Ursachen und nächste pflegerische/therapeutische Schritte.

Fall:
${valuesLine}

Antworte prägnant, didaktisch klar, auf Deutsch, ohne Latex.`;

    textarea.value = prompt;
    textarea.classList.remove("hidden");
  }

  function buildGeneratePrompt() {
    const mode = currentMode;
    const textarea = document.getElementById("ki-generate-output");

    const prompt =
`Erzeuge einen neuen, klinisch plausiblen BGA-Trainingsfall für Pflegefachpersonen.

Vorgaben:
- Modus: ${mode === "basic" ? "Basis (nur pH, pCO₂, HCO₃⁻, optional kurze Klinik)" : "Advanced (inkl. BE, Laktat, Na⁺, Glukose, Mischbilder möglich)"}.
- Liefere:
  - Werte (pH, pCO₂ [mmHg], HCO₃⁻ [mmol/L], ggf. BE, Laktat, Na⁺, Glukose)
  - Primäre Störung
  - Kompensationsstatus
  - 2–3 Stichworte zur klinischen Situation
- Antworte in sauberem, kompaktem Format, das ich direkt in ein BGA-Übungstool übernehmen kann.
- Sprache: Deutsch.`;

    textarea.value = prompt;
    textarea.classList.remove("hidden");
  }

  // ===== Events binden =====
  document.addEventListener("DOMContentLoaded", () => {
    // Modus-Umschalter
    document.getElementById("mode-basic").addEventListener("change", (e) => {
      if (e.target.checked) {
        currentMode = "basic";
        updateModeUI();
      }
    });
    document.getElementById("mode-advanced").addEventListener("change", (e) => {
      if (e.target.checked) {
        currentMode = "advanced";
        updateModeUI();
      }
    });

    // Buttons
    document.getElementById("evalbutton").addEventListener("click", evaluateCase);
    document.getElementById("resetbutton").addEventListener("click", resetCase);
    document.getElementById("nextcasebutton").addEventListener("click", nextCase);
    document.getElementById("ki-explain-btn").addEventListener("click", buildExplainPrompt);
    document.getElementById("ki-generate-btn").addEventListener("click", buildGeneratePrompt);

    // Start mit erstem Fall
    loadCase(0);
  });
</script>
</body>
</html>
